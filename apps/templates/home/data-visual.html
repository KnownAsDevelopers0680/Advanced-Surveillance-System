{% extends 'layouts/base.html' %}

{% block title %} Surveillance {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
    <style>
        .container {
            display: flex;
            flex-direction: row; /* Keep layout as row */
            justify-content: space-between; /* Space between graph and stats */
            align-items: flex-start; /* Align items to the top */
            height: 100vh;
            background-color: #f4f4f4;
            padding: 20px; /* Add some padding */
        }

        .header {
            text-align: center; /* Center the header */
            width: 100%; /* Full width */
            margin-bottom: 20px; /* Space below the header */
        }

        h2 {
            font-family: 'Arial', sans-serif;
            color: #333;
            margin: 0; /* Remove default margin */
        }

        /* Canvas style */
        #myLineChart {
            width: 90%; /* Increased width of the graph */
            max-width: 800px;
            height: 400px; /* Set fixed height */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid #eaeaea;
            border-radius: 8px;
            background-color: #fff;
        }

        /* Statistics container style */
        .stats {
            width: 40%; /* Decreased width for stats */
            padding: 10px; /* Reduced padding */
            background-color: #fff;
            height: 400px; /* Set same height as graph */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin-left: 20px; /* Space between chart and stats */
            display: flex;
            flex-direction: column; /* Stack items vertically */
            justify-content: flex-start; /* Align items to start */
        }

        .stats h3 {
            margin-top: 0;
            font-size: 1.3em; /* Reduced font size */
        }

        .stat {
            margin: 5px 0; /* Space between individual stats */
            padding: 5px; /* Reduced padding */
        }

        .minStat {
            background-color: rgba(255, 99, 132, 0.1); /* Light red for min accidents */
        }

        .maxStat {
            background-color: rgba(54, 162, 235, 0.1); /* Light blue for max accidents */
        }

        .stats p {
            margin: 2px 0; /* Space for individual paragraphs */
        }

        /* Dropdown style */
        select {
            padding: 10px;
            font-size: 16px;
            margin-bottom: 20px; /* Space below dropdown */
        }
    </style>
{% endblock stylesheets %}

{% block content %}

<div class="header">
    <h2 id="chartTitle">January Accident Line Chart</h2>
    <select id="monthSelector">
        <option value="1">January</option>
        <option value="2">February</option>
        <option value="3">March</option>
        <option value="4">April</option>
        <option value="5">May</option>
        <option value="6">June</option>
        <option value="7">July</option>
        <option value="8">August</option>
        <option value="9">September</option>
        <option value="10">October</option>
        <option value="11">November</option>
        <option value="12">December</option>
    </select>
</div>

<div class="container">
    <div>
        <!-- Canvas for the line chart -->
        <canvas id="myLineChart"></canvas>
    </div>
    
    <div class="stats">
        <h3>Accident Statistics</h3>
        <div class="stat minStat">
            <strong>Minimum Accidents:</strong> <span id="minAccidentsValue">0</span><br>
            <strong>When Minimum Accident Occurred:</strong> <span id="minAccidentsDates">Jan 1</span>
        </div>
        <div class="stat maxStat">
            <strong>Maximum Accidents:</strong> <span id="maxAccidentsValue">0</span><br>
            <strong>When Maximum Accident Occurred:</strong> <span id="maxAccidentsDates">Jan 1</span>
        </div>
        <div class="stat">
            <strong>Average Accidents per Day:</strong> <span id="avgAccidents">0</span>
        </div>
    </div>
</div>

{% include "includes/footer.html" %}

{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
    <!-- Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        const accidentDataByMonth = {
            1: [5, 7, 3, 8, 6, 2, 4, 0, 3, 1, 9, 10, 4, 2, 5, 8, 0, 3, 4, 6, 5, 2, 1, 7, 9, 3, 4, 6, 8, 10, 2],
            2: [3, 1, 4, 0, 2, 5, 6, 3, 4, 5, 1, 3, 2, 6, 4, 5, 2, 7, 0, 1, 3, 8, 4, 5, 6, 7, 2, 1],
            3: [10, 5, 6, 2, 3, 1, 4, 8, 7, 2, 5, 9, 0, 3, 4, 8, 6, 5, 2, 7, 4, 1, 3, 2, 6, 8, 5, 7, 9, 1, 0],
            4: [2, 4, 1, 0, 3, 5, 6, 7, 2, 1, 4, 3, 5, 6, 2, 0, 8, 1, 2, 6, 5, 4, 3, 7, 9, 8, 5, 4, 1, 0, 2],
            5: [8, 5, 4, 2, 1, 0, 3, 7, 4, 5, 6, 2, 1, 4, 0, 1, 2, 5, 6, 3, 2, 1, 4, 8, 9, 7, 0, 2, 1, 4, 3],
            6: [1, 2, 3, 4, 5, 6, 0, 8, 9, 10, 2, 1, 3, 4, 5, 6, 2, 7, 8, 1, 0, 3, 4, 2, 5, 1, 6, 0, 9, 4, 7],
            7: [0, 1, 3, 4, 2, 5, 6, 7, 8, 9, 0, 3, 4, 1, 2, 3, 5, 7, 6, 8, 4, 2, 1, 5, 3, 6, 0, 2, 1, 4, 8],
            8: [9, 10, 2, 3, 1, 4, 6, 5, 8, 7, 0, 1, 3, 2, 4, 5, 8, 6, 7, 1, 0, 4, 5, 3, 2, 1, 6, 8, 9, 7, 0],
            9: [3, 2, 1, 0, 5, 4, 6, 8, 10, 9, 3, 4, 1, 5, 2, 1, 0, 3, 4, 2, 6, 5, 3, 8, 9, 7, 0, 2, 1, 5, 4],
            10: [2, 3, 1, 0, 4, 5, 6, 7, 8, 9, 2, 1, 5, 3, 4, 2, 1, 0, 5, 7, 8, 4, 3, 1, 0, 6, 8, 7, 5, 3, 1],
            11: [5, 4, 3, 2, 1, 0, 6, 7, 8, 9, 2, 3, 1, 0, 5, 6, 8, 7, 0, 1, 2, 4, 3, 1, 0, 6, 4, 5, 2, 1, 0],
            12: [10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 5, 8, 3, 4, 2, 1, 0, 5, 7, 6, 5, 4, 3, 2, 1, 0, 5, 3, 2, 1],
        };

        const monthNames = [
            "January", "February", "March", "April", "May", "June", 
            "July", "August", "September", "October", "November", "December"
        ];

        const ctx = document.getElementById('myLineChart').getContext('2d');
        let myLineChart;

        let selectedMonth = 1; // Default selected month
        function updateChart() {
            const labels = Array.from({ length: accidentDataByMonth[selectedMonth].length }, (_, i) => i + 1);
            const data = accidentDataByMonth[selectedMonth];

            const minAccidents = Math.min(...data);
            const maxAccidents = Math.max(...data);
            const avgAccidents = (data.reduce((acc, val) => acc + val, 0) / data.length).toFixed(2);
            const minAccidentDates = data.map((accidents, index) => (accidents === minAccidents ? index + 1 : null)).filter(date => date).join(", ");
            const maxAccidentDates = data.map((accidents, index) => (accidents === maxAccidents ? index + 1 : null)).filter(date => date).join(", ");

            // Update statistics
            document.getElementById('minAccidentsValue').innerText = minAccidents;
            document.getElementById('minAccidentsDates').innerText = minAccidentDates;
            document.getElementById('maxAccidentsValue').innerText = maxAccidents;
            document.getElementById('maxAccidentsDates').innerText = maxAccidentDates;
            document.getElementById('avgAccidents').innerText = avgAccidents;

            // Update chart title
            document.getElementById('chartTitle').innerText = `${monthNames[selectedMonth - 1]} Accident Line Chart`;

            if (myLineChart) {
                myLineChart.destroy(); // Destroy previous chart instance
            }

            // Create a new chart
            myLineChart = new Chart(ctx, {
                type: 'line', // Change chart type to line
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Accidents',
                        data: data,
                        fill: true, // Fill the area under the line
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        tension: 0.4, // Makes the line curved
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Number of Accidents'
                            }
                        }
                    }
                }
            });
        }

        document.getElementById('monthSelector').addEventListener('change', (event) => {
            selectedMonth = parseInt(event.target.value);
            updateChart();
        });

        // Initialize chart on page load
        updateChart();
    </script>
{% endblock javascripts %}
