{% extends 'layouts/base.html' %}

{% block title %} Recordings {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}

{% endblock stylesheets %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <title>Incident Records</title> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
</head>

<div class="container mt-5">
    <h2>Video Recordings</h2>   
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Sr. No</th>
                <th>ID</th>
                <th>Video Name</th>
                <th>Video Link</th>
                <th>Timestamp</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody id="incidentTableBody">
            <!-- Records will be dynamically inserted here -->
        </tbody>
    </table>
</div>



{% include "includes/footer.html" %}
{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}

<script>
    // Function to fetch incident records
    async function fetchIncidentRecords() {
        try {
            const response = await fetch('/get_incident_records');
            const data = await response.json();

            if (data.status === 'success') {
                return data.data; // Return the records
            } else {
                console.error('Error fetching records:', data.message);
                return [];
            }
        } catch (error) {
            console.error('Fetch error:', error);
            return [];
        }
    }

    // Function to fetch video records
    async function fetchVideoRecords() {
        try {
            const response = await fetch('/get_videos');
            const data = await response.json();
            return data; // Assuming data is an array of video records
        } catch (error) {
            console.error('Error fetching videos:', error);
            return [];
        }
    }

    // Populate the table with combined data
    // Populate the table with combined data
async function populateTable() {
    const incidentRecords = await fetchIncidentRecords();
    const videoRecords = await fetchVideoRecords();

    const tableBody = document.getElementById('incidentTableBody');
    tableBody.innerHTML = ''; // Clear existing content

    // Loop through both incident and video records
    incidentRecords.forEach((record, index) => {
        const videoRecord = videoRecords[index]; // Assuming one-to-one mapping by index

        const row = `
            <tr>
                <td>${index + 1}</td> <!-- Serial Number Column -->
                <td>${record.id || 'N/A'}</td>
                <td>${videoRecord?.name || 'N/A'}</td>
                <td>
                    ${
                        videoRecord?.path
                            ? `<a href="${videoRecord.path}" target="_blank">Watch Video</a>`
                            : 'N/A'
                    }
                </td>
                <td>${record.timestamp || 'N/A'}</td>
                <td>${record.date || 'N/A'}</td>
            </tr>
        `;
        tableBody.innerHTML += row;
    });
}


    // Initialize table on page load
    document.addEventListener('DOMContentLoaded', populateTable);
</script>

{% endblock javascripts %}
